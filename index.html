<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Huerto Traval√≥n - Calendario de Fumigaci√≥n</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        text-align: center;
        background-color: #e8f5e9;
        margin: 0;
        padding: 20px;
      }
      .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
      }
      .calendar {
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 350px;
        transition: transform 0.2s;
      }
      .calendar:hover {
        transform: scale(1.05);
      }
      .month {
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #2e7d32;
      }
      .days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
      }
      .day {
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        font-size: 14px;
        background: #c8e6c9;
        cursor: pointer;
        transition: background 0.2s;
      }
      .day:hover {
        background: #81c784;
      }
      .fumigation {
        background: #ff7043;
        color: white;
      }
      /* Estilos del modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        max-width: 450px;
        text-align: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }
      .close {
        color: red;
        font-size: 24px;
        cursor: pointer;
        float: right;
      }
    </style>
  </head>
  <body>
    <h1 style="color: #1b5e20; font-size: 28px">
      üå± Huerto Traval√≥n - Calendario de Fumigaci√≥n Preventiva üåø
    </h1>
    <button onclick="openAdviceModal()">
      üìñ Consejos para un Huerto Ecol√≥gico
    </button>
    <div class="container" id="calendars"></div>

    <!-- Modal Consejos -->
    <div id="adviceModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close" onclick="closeAdviceModal()">&times;</span>
        <h2>Consejos para un Huerto Ecol√≥gico</h2>
        <ul style="text-align: left">
          <li>
            üåø Usa <strong>trampas crom√°ticas</strong> para monitorear plagas.
          </li>
          <li>
            üêû Introduce <strong>insectos beneficiosos</strong> como mariquitas
            y crisopas.
          </li>
          <li>üöú Alterna cultivos para evitar enfermedades en el suelo.</li>
          <li>üíß Evita el exceso de riego para prevenir hongos.</li>
          <li>
            üçÇ Aplica <strong>mantillo</strong> (mulch) para conservar la
            humedad y reducir malas hierbas.
          </li>
          <li>
            üå± Usa <strong>compost casero</strong> para enriquecer el suelo de
            forma natural.
          </li>
          <li>
            üåæ Practica la <strong>siembra asociada</strong> (ej. zanahorias con
            cebollas para repeler plagas).
          </li>
          <li>
            ‚òÄÔ∏è Siembra en funci√≥n de las <strong>fases lunares</strong> para
            mejorar el crecimiento.
          </li>
          <li>
            üßÑ Utiliza extractos naturales como
            <strong>infusi√≥n de ajo y ortiga</strong> contra plagas.
          </li>
          <li>üê¶ Instala casas para aves que ayuden a controlar insectos.</li>
          <li>
            üçÄ Deja zonas con flores silvestres para atraer polinizadores como
            abejas.
          </li>
          <li>
            üë®‚Äçüåæ Usa herramientas manuales en lugar de pesticidas sint√©ticos.
          </li>
          <li>
            ‚ö° Implementa un <strong>sistema de riego por goteo</strong> para
            ahorrar agua.
          </li>
          <li>
            üõë No uses productos qu√≠micos agresivos; opta por fertilizantes
            ecol√≥gicos.
          </li>
          <li>
            üåé Fomenta la biodiversidad plantando variedades locales y
            resistentes.
          </li>
        </ul>
      </div>
    </div>

    <!-- Modal Fumigaci√≥n -->
    <div id="fumigationModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle"></h2>
        <p id="modalContent"></p>
      </div>
    </div>

    <script>
      function openAdviceModal() {
        document.getElementById("adviceModal").style.display = "flex";
      }

      function closeAdviceModal() {
        document.getElementById("adviceModal").style.display = "none";
      }

      // Cerrar modal si se hace clic fuera del contenido
      window.onclick = function (event) {
        let modal = document.getElementById("adviceModal");
        if (event.target === modal) {
          modal.style.display = "none";
        }
      };
      const months = [
        "Enero",
        "Febrero",
        "Marzo",
        "Abril",
        "Mayo",
        "Junio",
        "Julio",
        "Agosto",
        "Septiembre",
        "Octubre",
        "Noviembre",
        "Diciembre",
      ];

      const seasons = {
        Enero: "Invierno",
        Febrero: "Invierno",
        Marzo: "Primavera",
        Abril: "Primavera",
        Mayo: "Primavera",
        Junio: "Verano",
        Julio: "Verano",
        Agosto: "Verano",
        Septiembre: "Oto√±o",
        Octubre: "Oto√±o",
        Noviembre: "Oto√±o",
        Diciembre: "Invierno",
      };

      // **Tratamientos y sus intervalos**
      const treatments = {
        Ajo: {
          start: 1,
          interval: { Invierno: 20, Primavera: 15, Verano: 10, Oto√±o: 15 },
          treatment: "Infusi√≥n de Ajo (Pulg√≥n, mosca blanca, trips)",
        },
        Azufre: {
          start: 15,
          interval: { Invierno: 35, Primavera: 30, Verano: 25, Oto√±o: 30 },
          treatment: "Azufre (Mildiu, o√≠dio, √°caros en clima fresco)",
        },
        Bacillus: {
          start: 5,
          interval: { Invierno: 25, Primavera: 20, Verano: 15, Oto√±o: 20 },
          treatment: "Bacillus thuringiensis (Tuta absoluta, orugas)",
        },
      };

      const currentYear = new Date().getFullYear();
      const appliedTreatments = {}; // Para almacenar los tratamientos asignados

      function generateAllCalendars() {
        let ajoDate = new Date(currentYear, 0, treatments.Ajo.start);
        let azufreDate = new Date(currentYear, 0, treatments.Azufre.start);
        let bacillusDate = new Date(currentYear, 0, treatments.Bacillus.start);

        while (
          ajoDate.getFullYear() === currentYear ||
          azufreDate.getFullYear() === currentYear ||
          bacillusDate.getFullYear() === currentYear
        ) {
          let ajoMonth = ajoDate.getMonth();
          let azufreMonth = azufreDate.getMonth();
          let bacillusMonth = bacillusDate.getMonth();

          let ajoSeason = seasons[months[ajoMonth]];
          let azufreSeason = seasons[months[azufreMonth]];
          let bacillusSeason = seasons[months[bacillusMonth]];

          let ajoInterval = treatments.Ajo.interval[ajoSeason];
          let azufreInterval = treatments.Azufre.interval[azufreSeason];
          let bacillusInterval = treatments.Bacillus.interval[bacillusSeason];

          let ajoKey = formatDate(ajoDate);
          let azufreKey = formatDate(azufreDate);
          let bacillusKey = formatDate(bacillusDate);

          // **Evitar colisiones y reubicar tratamientos si est√°n muy juntos**
          if (!hasConflict(ajoDate)) {
            appliedTreatments[ajoKey] = treatments.Ajo.treatment;
            console.log(`‚úÖ Asignando Ajo en ${ajoKey}`);
            ajoDate.setDate(ajoDate.getDate() + ajoInterval);
          } else {
            ajoDate.setDate(ajoDate.getDate() + 4); // Moverlo 4 d√≠as adelante si hay conflicto
          }

          if (!hasConflict(azufreDate)) {
            appliedTreatments[azufreKey] = treatments.Azufre.treatment;
            console.log(`‚úÖ Asignando Azufre en ${azufreKey}`);
            azufreDate.setDate(azufreDate.getDate() + azufreInterval);
          } else {
            azufreDate.setDate(azufreDate.getDate() + 4); // Moverlo 4 d√≠as adelante si hay conflicto
          }

          if (!hasConflict(bacillusDate)) {
            appliedTreatments[bacillusKey] = treatments.Bacillus.treatment;
            console.log(`‚úÖ Asignando Bacillus en ${bacillusKey}`);
            bacillusDate.setDate(bacillusDate.getDate() + bacillusInterval);
          } else {
            bacillusDate.setDate(bacillusDate.getDate() + 4); // Moverlo 4 d√≠as adelante si hay conflicto
          }
        }

        // **Generar los calendarios**
        for (let month = 0; month < 12; month++) {
          let firstDayOfWeek =
            (new Date(currentYear, month, 1).getDay() + 6) % 7;
          generateCalendar(
            month,
            currentYear,
            appliedTreatments,
            firstDayOfWeek
          );
        }

        console.log("üìå D√≠as de fumigaci√≥n asignados:", appliedTreatments);
      }

      // **Funci√≥n para verificar si hay conflicto con otro tratamiento cercano**
      function hasConflict(date) {
        for (let i = -3; i <= 3; i++) {
          let checkDate = new Date(date);
          checkDate.setDate(date.getDate() + i);
          let key = formatDate(checkDate);
          if (appliedTreatments[key]) return true;
        }
        return false;
      }

      // **Formatea la fecha como YYYY-MM-DD**
      function formatDate(date) {
        return `${date.getFullYear()}-${(date.getMonth() + 1)
          .toString()
          .padStart(2, "0")}-${date.getDate()}`;
      }

      function generateCalendar(month, year, treatments, firstDayOfWeek) {
        let container = document.createElement("div");
        container.className = "calendar";

        let monthTitle = document.createElement("div");
        monthTitle.className = "month";
        const seasonIcons = {
          Invierno: "‚ùÑÔ∏è",
          Primavera: "üå∏",
          Verano: "‚òÄÔ∏è",
          Oto√±o: "üçÇ",
        };

        monthTitle.innerHTML = `${seasonIcons[seasons[months[month]]]} ${
          months[month]
        }`;

        let daysContainer = document.createElement("div");
        daysContainer.className = "days";

        // **Espacios en blanco antes del primer d√≠a del mes**
        for (let i = 0; i < firstDayOfWeek; i++) {
          let emptyDay = document.createElement("div");
          emptyDay.className = "day";
          daysContainer.appendChild(emptyDay);
        }

        let daysInMonth = new Date(year, month + 1, 0).getDate();
        for (let day = 1; day <= daysInMonth; day++) {
          let dayDiv = document.createElement("div");
          dayDiv.className = "day";
          dayDiv.textContent = day;

          let key = `${year}-${(month + 1).toString().padStart(2, "0")}-${day}`;
          if (treatments[key]) {
            dayDiv.classList.add("fumigation");
            dayDiv.onclick = function () {
              alert(
                `Fumigaci√≥n el ${day} de ${months[month]}: ${treatments[key]}`
              );
            };
          }

          daysContainer.appendChild(dayDiv);
        }

        container.appendChild(monthTitle);
        container.appendChild(daysContainer);
        document.getElementById("calendars").appendChild(container);
      }

      generateAllCalendars();
    </script>
  </body>
</html>
